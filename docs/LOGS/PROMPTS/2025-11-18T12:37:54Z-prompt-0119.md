---
id: prompt-0119
epoch: 0009-real-edge-integration
issued_at: 2025-11-18T12:37:54Z
accepted_at: 2025-11-18T12:38:10Z
completed_at: 2025-11-18T12:45:00Z
status: completed
branch: work
pr: 
validation_checks: []
---

Fix intentions API auth for production autosave

## Notes
- Autosave 401s only hit production because preview/dev bypass NextAuth via the static test session. Production requests need the
  real JWT cookie, so failing to resolve the email caused `Sign in required` errors even while the UI showed an authenticated user.
- Updated the intentions route to read the signed NextAuth JWT directly via `getToken()` so the handler can always extract the
  email from the incoming request context.
- Added structured logging for token parsing failures so prod logs clearly show whether auth decoding is the blocker.
- Follow-up actions:
  - Monitor prod autosave traffic to confirm 200s after deployment.

## Validation
- command: npm run lint
  outcome: pass
  notes: ""
