---
id: prompt-0120
epoch: 0009-real-edge-integration
issued_at: 2025-11-18T13:05:23Z
accepted_at: 2025-11-18T13:05:30Z
completed_at: 2025-11-18T13:32:00Z
status: completed
branch: work
pr: 
validation_checks: []
---

Restore production autosave by reusing NextApi auth

## Notes
- Prod saves were still returning 401 because the App Router route handler could not reliably resolve the NextAuth session even
  after the earlier getToken patch. Moving the endpoint back to the `pages/api` runtime lets us use `getServerSession(req, res,
  authOptions)` just like the working Steps API, so the cookie decoding follows the supported path documented in prompt-0116.
- Added a JSON content-type guard for write operations to surface malformed payloads early.
- Follow-up actions:
  - Monitor prod autosave logs to confirm we only see 200/500 level responses after real logins, not 401s.

## Validation
- command: npm run lint
  outcome: pass
  notes: "TypeScript version warning bubbled up from local toolchain (5.9.3)."
