---
id: prompt-0109
epoch: epoch-0008
issued_at: 2025-11-16T09:14:20Z
accepted_at: 2025-11-16T09:14:20Z
completed_at: 2025-11-16T09:30:00Z
status: complete
branch: feature/epoch-0008/opportunity-ai-simulation
pr:
validation_checks:
  - command: npm test -- --runTestsByPath test/components/Canvas/normaliseStepFromApi.test.ts test/ui/StepCard.test.tsx test/hooks/useOpportunities.test.tsx
    outcome: pass
    notes: Verifies normalisation helpers, the step card wiring, and the opportunities hook behaviour after the persistence changes.
---

Persist manual steps so opportunities hook can fetch

## Summary
- Added a manual-step persistence helper in the Canvas that POSTs new steps to `/api/steps`, updates the relevant step with the returned backend id, and logs success or failure.
- Updated `/api/steps` and `saveUserStep` so single-step writes always assign a canonical database id, stamp the user metadata, and return the persisted identifier to the caller.
- Recorded the validation command covering the Canvas normaliser, StepCard wiring, and the opportunities hook to keep the trace complete.

## Notes
- Follow-up actions:
  - Monitor staging to ensure manual steps receive ids quickly enough for the opportunities hook to run without a reload.

## Validation
- command: npm test -- --runTestsByPath test/components/Canvas/normaliseStepFromApi.test.ts test/ui/StepCard.test.tsx test/hooks/useOpportunities.test.tsx
  outcome: pass
  notes: Matches the validation entry above.
