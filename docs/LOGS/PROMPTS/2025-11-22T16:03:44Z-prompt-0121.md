---
id: prompt-0121
epoch: epoch-0010-prompt-refinement
issued_at: 2025-11-22T16:03:44Z
accepted_at: 2025-11-22T16:03:51Z
completed_at: 2025-11-22T16:03:51Z
status: completed
branch: work
pr: 23
validation_checks:
  - LLM=test-model npm test -- test/api/ai.suggest-steps.test.ts
  - |
    python - <<'PY'
    import json
    import pathlib
    import yaml
    from jsonschema import validate

    schema = json.loads(pathlib.Path('docs/SCHEMA/pr-log.schema.json').read_text())
    pr_path = pathlib.Path('docs/LOGS/PRS/pr-0023-epoch-0010-llm-env-enforcement.md')
    content = pr_path.read_text().splitlines()
    yaml_text = "\n".join(line for line in content if not line.startswith('# '))
    data = yaml.safe_load(yaml_text)
    validate(instance={k: data[k] for k in ['id', 'number', 'title', 'status']}, schema=schema)
    print('PR log schema validation passed')
    PY
---

Enforce the LLM env var as the single model source and surface suggest-steps errors clearly.

## Notes
- Follow-up actions:
  - None

## Validation
- command: LLM=test-model npm test -- test/api/ai.suggest-steps.test.ts
  outcome: passed
  notes: "Updated suggest-steps API test expectations and model field assertion."
- command: |
    python - <<'PY'
    import json
    import pathlib
    import yaml
    from jsonschema import validate

    schema = json.loads(pathlib.Path('docs/SCHEMA/pr-log.schema.json').read_text())
    pr_path = pathlib.Path('docs/LOGS/PRS/pr-0023-epoch-0010-llm-env-enforcement.md')
    content = pr_path.read_text().splitlines()
    yaml_text = "\n".join(line for line in content if not line.startswith('# '))
    data = yaml.safe_load(yaml_text)
    validate(instance={k: data[k] for k in ['id', 'number', 'title', 'status']}, schema=schema)
    print('PR log schema validation passed')
    PY
  outcome: passed
  notes: "Validated PR log against pr-log.schema.json."
