---
id: prompt-0116
epoch: 0009-real-edge-integration
issued_at: 2025-11-18T10:29:19Z
accepted_at: 2025-11-18T10:29:30Z
completed_at: 2025-11-18T10:45:00Z
status: completed
branch: work
pr:
validation_checks:
  - command: npm run lint
    outcome: pass
    notes: "Repo lint clean after autosave diagnostics"
---

Diagnose production autosave regression

## Notes
- Preview works because `lib/auth/server.ts` and `lib/auth/config.ts` return a static test session whenever `isProd` is `false`, so `/api/intentions` always sees a user there.
- Production flips `isProd` to `true`, forcing `getServerSession`/NextAuth to resolve the logged-in Google account. Missing or expired auth therefore makes `resolveUserEmail()` return `null`, so `app/api/intentions/route.ts` responds with 401 and the client silently retries forever.
- Added autosave logging + surfaced error text in the SaveStatus chip so the debug panel and UI clearly call out the `Sign in required` failure mode during diagnosis.
- Follow-up actions:
  - Confirm Google auth + Mongo creds are set in production so real sessions can persist data once users sign in.

## Validation
- command: npm run lint
  outcome: pass
  notes: "Matches validation_checks"
